<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MicroPython REPL Demo</title>
  <link rel="stylesheet" href="./css/index.css">
  <script type="module">
    import dedent from 'https://cdn.jsdelivr.net/npm/codedent/es.js';
    import init from './micro-repl.js';

    const show = textContent => {
      output.append(
        Object.assign(
          document.createElement('code'),
          { textContent }
        )
      );
    };

    connect.onclick = () => {
      connect.disabled = true;
      output.replaceChildren();
      init({
        onceClosed(error) {
          connect.disabled = false;
          if (error) console.warn(error);
        }
      }).then(async board => {
        globalThis.board = board;
        toggle.disabled = false;
        await board.write(dedent(`
            import machine, neopixel
            pixel_pin = 16
            pixel = neopixel.NeoPixel(machine.Pin(pixel_pin), 1)
        `));
      });
    };

    let active = false;
    toggle.onclick = () => {
        active = !active;
        board.write(dedent(`
            pixel[0] = (${active ? '255, 255, 255' : '0, 0, 0'})
            pixel.write()
        `));
    };

  </script>
</head>
<body>
  <button id="connect">connect</button>
  <button id="toggle" disabled>LED toggle</button>
  <pre id="output"></pre>
</body>
</html>
